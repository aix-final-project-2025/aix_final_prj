# ===============================
# ğŸ§  AIX Final Project â€” Dockerfile
# Hugging Face Spaces optimized (manage.py entry)
# ===============================

FROM python:3.11-slim

# ---------------------------------
# ğŸ§° ê¸°ë³¸ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (ë””ë²„ê¹… ë° ëª¨ë‹ˆí„°ë§ìš©)
# ---------------------------------
RUN apt update && apt install -y \
    procps \
    curl \
    nano \
    net-tools \
    && apt clean && rm -rf /var/lib/apt/lists/*

# ---------------------------------
# ğŸ“ ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
# ---------------------------------
WORKDIR /app

# ---------------------------------
# ğŸ“¦ ì „ì²´ í”„ë¡œì íŠ¸ ë³µì‚¬ (keras í¬í•¨)
# ---------------------------------
# ğŸ‘‰ ì´ í•œ ì¤„ë¡œ ëª¨ë“  í´ë”ê°€ ë³µì‚¬ë˜ë¯€ë¡œ keras_utils.py ì ˆëŒ€ê²½ë¡œë„ ìë™ ì •í•©ë¨
COPY . .

# ---------------------------------
# ğŸ“œ Python ì˜ì¡´ì„± ì„¤ì¹˜
# ---------------------------------
RUN pip install --no-cache-dir -r requirements.txt

# ---------------------------------
# âš™ï¸ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
# ---------------------------------
ENV PYTHONUNBUFFERED=1
ENV DJANGO_SETTINGS_MODULE=aix_final_prj.settings

# ---------------------------------
# ğŸ”¥ í¬íŠ¸ ë…¸ì¶œ
# ---------------------------------
EXPOSE 7860

# ---------------------------------
# ğŸš€ ì‹¤í–‰ ëª…ë ¹ (manage.py ê¸°ì¤€ ì‹¤í–‰)
# ---------------------------------
CMD ["bash", "-c", "python manage.py migrate --noinput && python app.py"]