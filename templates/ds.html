{% extends "base.html" %}
{% load static %}

{% block page_title %}ì»¤í”¼ë°ì´í„° ë¶„ì„{% endblock %}

{% block extra_head %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django ê¸°ë°˜ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 20px; }
        .card-header { font-weight: bold; background-color: #f8f9fa; border-bottom: 1px solid #e9ecef; }
        .table th, .table td { vertical-align: middle; }
    </style>

</head>

    <div class="container">
        <h1 class="mb-4 text-center text-primary">â˜• ì»¤í”¼ ë° ê±´ê°• ë°ì´í„° ë¶„ì„ ë¦¬í¬íŠ¸</h1>
        <p class="text-muted text-center">Django ë·° í•¨ìˆ˜ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³  ì‹œê°í™”(í…ìŠ¤íŠ¸)í–ˆìŠµë‹ˆë‹¤.</p>
           
        <div class="row mb-5">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-info text-white">
                        1. ì»¤í”¼ ì„­ì·¨ëŸ‰ ê¸°ë³¸ í†µê³„
                    </div>
                    <div class="card-body">
                        <dl class="row">
                            <dt class="col-sm-3">í‰ê·  (Mean)</dt>
                            <dd class="col-sm-9">{{ coffee_summary.mean }} ì»µ</dd>
                            
                            <dt class="col-sm-3">ì¤‘ì•™ê°’ (Median)</dt>
                            <dd class="col-sm-9">{{ coffee_summary.median }} ì»µ</dd>

                            <dt class="col-sm-3">í‘œì¤€í¸ì°¨ (Std)</dt>
                            <dd class="col-sm-9">{{ coffee_summary.std }}</dd>

                            <dt class="col-sm-3">ë²”ìœ„ (Range)</dt>
                            <dd class="col-sm-9">{{ coffee_summary.range }} ì»µ</dd>

                            <dt class="col-sm-3">ì‚¬ë¶„ìœ„ ë²”ìœ„ (IQR)</dt>
                            <dd class="col-sm-9">{{ coffee_summary.iqr }}</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mb-5">
            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-success text-white">
                        2. ì£¼ìš” ê±´ê°• ì§€í‘œ í‰ê· 
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><strong>í‰ê·  BMI:</strong> {{ health_metrics.bmi_mean }}</li>
                            <li class="list-group-item"><strong>í‰ê·  ìˆ˜ë©´ ì‹œê°„:</strong> {{ health_metrics.sleep_mean }} ì‹œê°„</li>
                            <li class="list-group-item"><strong>í‰ê·  ì‹¬ë°•ìˆ˜:</strong> {{ health_metrics.heart_rate_mean }} BPM</li>
                            <li class="list-group-item"><strong>í‰ê·  í™œë™ ì‹œê°„:</strong> {{ health_metrics.activity_mean }} ì‹œê°„/ì£¼</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-warning text-dark">
                        3. ì»¤í”¼ ì„­ì·¨ëŸ‰ê³¼ ê°€ì¥ ìƒê´€ê´€ê³„ ë†’ì€ ë³€ìˆ˜ (ìƒìœ„ 5ê°œ)
                    </div>
                    <div class="card-body">
                        <table class="table table-sm table-hover">
                            <thead>
                                <tr>
                                    <th>ë³€ìˆ˜</th>
                                    <th>ìƒê´€ê³„ìˆ˜ ($\rho$)</th>
                                    <th>ë°©í–¥</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in corr_summary %}
                                <tr>
                                    <td>{{ item.variable }}</td>
                                    <td>{{ item.correlation }}</td>
                                    <td>{{ item.direction }}</td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="3">ìƒê´€ê´€ê³„ ìš”ì•½ ë°ì´í„° ì—†ìŒ.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        4. êµ­ê°€ë³„ ì»¤í”¼ ì„­ì·¨ëŸ‰ ìˆœìœ„ (í‰ê·  ê¸°ì¤€)
                    </div>
                    <div class="card-body">
                        <table class="table table-striped table-bordered table-sm">
                            <thead>
                                <tr>
                                    <th>ìˆœìœ„</th>
                                    <th>êµ­ê°€ (Country)</th>
                                    <th>í‰ê·  ì»¤í”¼ ì„­ì·¨ëŸ‰</th>
                                    <th>í‘œë³¸ í¬ê¸°</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in country_summary %}
                                <tr>
                                    <td>{{ item.rank }}</td>
                                    <td>{{ item.country }}</td>
                                    <td>{{ item.mean }}</td>
                                    <td>{{ item.sample_size }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-primary text-white">
                        5. ì„±ë³„ ì»¤í”¼ ë° ê±´ê°• ì§€í‘œ
                    </div>
                    <div class="card-body">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>ì„±ë³„</th>
                                    <th>í‘œë³¸ìˆ˜</th>
                                    <th>ì»¤í”¼ í‰ê· </th>
                                    <th>BMI í‰ê· </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in gender_summary %}
                                <tr>
                                    <td>{{ item.gender }}</td>
                                    <td>{{ item.count }}</td>
                                    <td>{{ item.coffee_mean }}</td>
                                    <td>{{ item.bmi_mean }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-danger text-white">
                        6. ì—°ë ¹ëŒ€ë³„ ì»¤í”¼ ì„­ì·¨ëŸ‰
                    </div>
                    <div class="card-body">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>ì—°ë ¹ëŒ€</th>
                                    <th>í‰ê·  ì„­ì·¨ëŸ‰</th>
                                    <th>í‘œì¤€í¸ì°¨</th>
                                    <th>í‘œë³¸ìˆ˜</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in age_summary %}
                                <tr>
                                    <td>{{ item.age_group }}</td>
                                    <td>{{ item.mean }}</td>
                                    <td>{{ item.std }}</td>
                                    <td>{{ item.count }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-dark text-white">
                        7. ë¨¸ì‹ ëŸ¬ë‹ ë°ì´í„° ì¤€ë¹„ ìš”ì•½
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>ë²”ì£¼í˜• ë³€ìˆ˜ ì¸ì½”ë”©</h5>
                                <ul class="list-group list-group-flush">
                                    {% for item in encoding_summary %}
                                        <li class="list-group-item">
                                            <strong>{{ item.column }}:</strong> 
                                            <small>{{ item.mapping }}</small>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>íƒ€ê²Ÿ ë³€ìˆ˜ í†µê³„</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item"><strong>ìƒìœ„ ì»¤í”¼ ì†Œë¹„ì (High_Coffee_Consumer):</strong> {{ target_summary.high_coffee }}ëª… ({{ target_summary.high_coffee_pct }}%)</li>
                                    <li class="list-group-item"><strong>ìˆ˜ë©´ ë¶€ì¡± (Poor_Sleep):</strong> {{ target_summary.poor_sleep }}ëª… ({{ target_summary.poor_sleep_pct }}%)</li>
                                    <li class="list-group-item"><strong>ê³  BMI (High_BMI):</strong> {{ target_summary.high_bmi }}ëª… ({{ target_summary.high_bmi_pct }}%)</li>
                                </ul>
                                
                                <h5 class="mt-3">ë‹¤ì¤‘ê³µì„ ì„± ê²€ì‚¬ ($\rho > 0.8$)</h5>
                                {% for item in multicollinearity_summary %}
                                    <p class="mb-1 text-danger">
                                        {% if item.message %}
                                            {{ item.message }}
                                        {% else %}
                                            ğŸš¨ {{ item.var1 }} - {{ item.var2 }}: {{ item.corr }}
                                        {% endif %}
                                    </p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center text-muted py-4">
            <p>&copy; 2025 Coffee Analysis Report by Django</p>
        </footer>
    </div>
{% endblock %}

{% block extra_script %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}