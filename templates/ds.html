{% extends "base.html" %}
{% load static %}

{% block page_title %}커피데이터 분석{% endblock %}

{% block extra_head %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django 기반 분석 대시보드</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 20px; }
        .card-header { font-weight: bold; background-color: #f8f9fa; border-bottom: 1px solid #e9ecef; }
        .table th, .table td { vertical-align: middle; }
    </style>

</head>

    <div class="container">
        <h1 class="mb-4 text-center text-primary">☕ 커피 및 건강 데이터 분석 리포트</h1>
        <p class="text-muted text-center">Django 뷰 함수를 통해 데이터를 처리하고 시각화(텍스트)했습니다.</p>
           
        <div class="row mb-5">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-info text-white">
                        1. 커피 섭취량 기본 통계
                    </div>
                    <div class="card-body">
                        <dl class="row">
                            <dt class="col-sm-3">평균 (Mean)</dt>
                            <dd class="col-sm-9">{{ coffee_summary.mean }} 컵</dd>
                            
                            <dt class="col-sm-3">중앙값 (Median)</dt>
                            <dd class="col-sm-9">{{ coffee_summary.median }} 컵</dd>

                            <dt class="col-sm-3">표준편차 (Std)</dt>
                            <dd class="col-sm-9">{{ coffee_summary.std }}</dd>

                            <dt class="col-sm-3">범위 (Range)</dt>
                            <dd class="col-sm-9">{{ coffee_summary.range }} 컵</dd>

                            <dt class="col-sm-3">사분위 범위 (IQR)</dt>
                            <dd class="col-sm-9">{{ coffee_summary.iqr }}</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mb-5">
            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-success text-white">
                        2. 주요 건강 지표 평균
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><strong>평균 BMI:</strong> {{ health_metrics.bmi_mean }}</li>
                            <li class="list-group-item"><strong>평균 수면 시간:</strong> {{ health_metrics.sleep_mean }} 시간</li>
                            <li class="list-group-item"><strong>평균 심박수:</strong> {{ health_metrics.heart_rate_mean }} BPM</li>
                            <li class="list-group-item"><strong>평균 활동 시간:</strong> {{ health_metrics.activity_mean }} 시간/주</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-warning text-dark">
                        3. 커피 섭취량과 가장 상관관계 높은 변수 (상위 5개)
                    </div>
                    <div class="card-body">
                        <table class="table table-sm table-hover">
                            <thead>
                                <tr>
                                    <th>변수</th>
                                    <th>상관계수 ($\rho$)</th>
                                    <th>방향</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in corr_summary %}
                                <tr>
                                    <td>{{ item.variable }}</td>
                                    <td>{{ item.correlation }}</td>
                                    <td>{{ item.direction }}</td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="3">상관관계 요약 데이터 없음.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        4. 국가별 커피 섭취량 순위 (평균 기준)
                    </div>
                    <div class="card-body">
                        <table class="table table-striped table-bordered table-sm">
                            <thead>
                                <tr>
                                    <th>순위</th>
                                    <th>국가 (Country)</th>
                                    <th>평균 커피 섭취량</th>
                                    <th>표본 크기</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in country_summary %}
                                <tr>
                                    <td>{{ item.rank }}</td>
                                    <td>{{ item.country }}</td>
                                    <td>{{ item.mean }}</td>
                                    <td>{{ item.sample_size }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-primary text-white">
                        5. 성별 커피 및 건강 지표
                    </div>
                    <div class="card-body">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>성별</th>
                                    <th>표본수</th>
                                    <th>커피 평균</th>
                                    <th>BMI 평균</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in gender_summary %}
                                <tr>
                                    <td>{{ item.gender }}</td>
                                    <td>{{ item.count }}</td>
                                    <td>{{ item.coffee_mean }}</td>
                                    <td>{{ item.bmi_mean }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-danger text-white">
                        6. 연령대별 커피 섭취량
                    </div>
                    <div class="card-body">
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>연령대</th>
                                    <th>평균 섭취량</th>
                                    <th>표준편차</th>
                                    <th>표본수</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in age_summary %}
                                <tr>
                                    <td>{{ item.age_group }}</td>
                                    <td>{{ item.mean }}</td>
                                    <td>{{ item.std }}</td>
                                    <td>{{ item.count }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-dark text-white">
                        7. 머신러닝 데이터 준비 요약
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>범주형 변수 인코딩</h5>
                                <ul class="list-group list-group-flush">
                                    {% for item in encoding_summary %}
                                        <li class="list-group-item">
                                            <strong>{{ item.column }}:</strong> 
                                            <small>{{ item.mapping }}</small>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>타겟 변수 통계</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item"><strong>상위 커피 소비자 (High_Coffee_Consumer):</strong> {{ target_summary.high_coffee }}명 ({{ target_summary.high_coffee_pct }}%)</li>
                                    <li class="list-group-item"><strong>수면 부족 (Poor_Sleep):</strong> {{ target_summary.poor_sleep }}명 ({{ target_summary.poor_sleep_pct }}%)</li>
                                    <li class="list-group-item"><strong>고 BMI (High_BMI):</strong> {{ target_summary.high_bmi }}명 ({{ target_summary.high_bmi_pct }}%)</li>
                                </ul>
                                
                                <h5 class="mt-3">다중공선성 검사 ($\rho > 0.8$)</h5>
                                {% for item in multicollinearity_summary %}
                                    <p class="mb-1 text-danger">
                                        {% if item.message %}
                                            {{ item.message }}
                                        {% else %}
                                            🚨 {{ item.var1 }} - {{ item.var2 }}: {{ item.corr }}
                                        {% endif %}
                                    </p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center text-muted py-4">
            <p>&copy; 2025 Coffee Analysis Report by Django</p>
        </footer>
    </div>
{% endblock %}

{% block extra_script %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}