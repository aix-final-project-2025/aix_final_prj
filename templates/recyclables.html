{% extends "base.html" %}
{% load static %}

{% block page_title %}ì¬í™œìš© ë¦¬ìŠ¤íŠ¸{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/recyclables.css' %}">
{% endblock %}

{% block content %}
<div class="recycling-table-container"> 
    <h2>ì¬í™œìš© í•­ëª© ë¦¬ìŠ¤íŠ¸ (ìµœì‹ ìˆœ)</h2>
        <a href="{% url 'core:upload' %}" class="upload-btn-relative" title="í•­ëª© ì—…ë¡œë“œ">
        Upload</a>
    
    <table class="recycling-table"> 
        <thead>
            <tr>
                <th>ì‚¬ì§„</th>
                <th>ì„¤ëª…</th>
                <th>ìˆ˜ì •</th>  <th>ì‚­ì œ</th>  </tr>
        </thead>
        <tbody>
            {% for item in recycling_items %}
            <tr class="recycling-item" data-item-id="{{ item.id }}"> 
                
                <td class="item-image-cell">
                    <div class="item-image">
                        <img src="{{ item.image.url }}" alt="ì—…ë¡œë“œ ì´ë¯¸ì§€">
                    </div>
                </td>

                <td class="item-details-cell">
                    <p class="description-text">{{ item.description }}</p>
                </td>

                <td class="item-action-cell">
                    <button class="edit-btn" data-id="{{ item.id }}">
                        <img src="{% static 'images/edit_icon.png' %}" alt="ìˆ˜ì •" class="action-icon">
                    </button>
                </td>
                
                <td class="item-action-cell">
                    <button class="delete-btn" data-id="{{ item.id }}">
                        <img src="{% static 'images/trash_icon.png' %}" alt="ì‚­ì œ" class="action-icon">
                    </button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">ì•„ì§ ë“±ë¡ëœ ì¬í™œìš© í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td> </tr>
            {% endfor %}
        </tbody>
    </table> 
</div>
{% endblock %}


{% block extra_script %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const listContainer = document.querySelector('.recycling-table-container'); // ğŸŸ¢ ì„ íƒì ë³€ê²½

    listContainer.addEventListener('click', function(event) {
        const target = event.target.closest('.edit-btn');
        if (target) {
            const itemId = target.dataset.id;
            const itemElement = target.closest('.recycling-item');
            const descriptionElement = itemElement.querySelector('.description-text');
            
            // í˜„ì¬ í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const currentText = descriptionElement.textContent;
            
            // í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥ ê°€ëŠ¥í•œ <textarea>ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
            const textareaHtml = `<textarea id="edit-desc-${itemId}" class="edit-textarea">${currentText}</textarea>`;
            
            descriptionElement.innerHTML = textareaHtml;
            
            // ë²„íŠ¼ì„ 'ì €ì¥' ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
            target.innerHTML = `<img src="{% static 'images/save_icon.png' %}" alt="ì €ì¥" class="action-icon">`;
            target.classList.remove('edit-btn');
            target.classList.add('save-btn');
            
            // í¬ì»¤ìŠ¤ë¥¼ í…ìŠ¤íŠ¸ ì˜ì—­ìœ¼ë¡œ ì´ë™
            document.getElementById(`edit-desc-${itemId}`).focus();

            // âš ï¸ ì‹¤ì œ ì €ì¥ ë° ì‚­ì œ ë¡œì§ì€ ë³„ë„ì˜ Django View(POST ìš”ì²­)ë¥¼ ë§Œë“¤ì–´ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.
            alert(`í•­ëª© ID ${itemId}ì˜ ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. ì €ì¥/ì‚­ì œ ê¸°ëŠ¥ êµ¬í˜„ í•„ìš”.`);
        }
        
        // ğŸš¨ ì‚­ì œ ë²„íŠ¼ ë¡œì§ (ì‹¤ì œ DB ì‚­ì œ ë¡œì§ í•„ìš”)
        const deleteTarget = event.target.closest('.delete-btn');
        if (deleteTarget) {
            const itemId = deleteTarget.dataset.id;
            if (confirm("ì •ë§ë¡œ ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                // ì—¬ê¸°ì— Django DELETE Viewë¡œ ìš”ì²­ì„ ë³´ë‚´ëŠ” AJAX ì½”ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.
                alert(`í•­ëª© ID ${itemId}ë¥¼ ì‚­ì œí•˜ëŠ” ë¡œì§ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. (ì‹¤ì œ ì‚­ì œëŠ” ë¯¸êµ¬í˜„)`);
            }
        }
    });
});
</script>
{% endblock %}